name: Malachite Guardian ğŸ›¡ï¸

# TRIGGER EVENTS:
# The Guardian wakes up on every Push to the main branch
# or when someone opens a Pull Request.
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# AUTOMATED TASKS:
jobs:
  validate-integrity:
    name: Validate Causal Topology
    runs-on: ubuntu-latest  # Uses a fresh Linux virtual machine

    steps:
    # 1. Download the repository code to the virtual machine
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    # 2. Set up Python environment (using version 3.11)
    - name: ğŸ Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
        cache: 'pip' # Enables caching to make future runs faster

    # 3. Install required libraries (Pandas, NetworkX, Pyvis)
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 4. RUN THE SHERIFF (Causal Validator)
    # If this script finds an error (exit code 1), the build fails âŒ
    - name: ğŸ•µï¸ Run Causal Validation
      run: |
        python tools/validate.py

    # 5. VERIFY VISUALIZATION
    # Ensures the graph can be rendered without errors
    - name: ğŸ¨ Verify Graph Visualization
      run: |
        python tools/visualize.py