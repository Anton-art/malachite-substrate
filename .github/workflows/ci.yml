name: Malachite Guardian & Publisher üöÄ

# –ö–û–ì–î–ê –ó–ê–ü–£–°–ö–ê–¢–¨:
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch: # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

# –ü–†–ê–í–ê –î–û–°–¢–£–ü–ê (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∞–π—Ç–∞):
permissions:
  contents: write

jobs:
  build-and-deploy:
    name: Validate & Publish
    runs-on: ubuntu-latest

    steps:
    # 1. –°–∫–∞—á–∏–≤–∞–µ–º –∫–æ–¥
    - name: üì• Checkout Repository
      uses: actions/checkout@v4

    # 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Python
    - name: üêç Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
        cache: 'pip'

    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    - name: üì¶ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 4. –ó–ê–ü–£–°–ö–ê–ï–ú –®–ï–†–ò–§–ê (–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏)
    - name: üïµÔ∏è Run Causal Validation
      run: |
        python tools/validate.py

    # 5. –ì–ï–ù–ï–†–ò–†–£–ï–ú –ì–†–ê–§ (–•—É–¥–æ–∂–Ω–∏–∫)
    # –ú—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º—ã –≥–æ—Ç–æ–≤–∏–º —Ñ–∞–π–ª –¥–ª—è —Å–∞–π—Ç–∞
    - name: üé® Generate Graph & Prepare Site
      run: |
        python tools/visualize.py
        # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Ñ–∞–π–ª, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–ª –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        mv malachite_graph.html index.html

    # 6. –ü–£–ë–õ–ò–ö–£–ï–ú –°–ê–ô–¢ (–ò–∑–¥–∞—Ç–µ–ª—å)
    # –≠—Ç–æ—Ç —à–∞–≥ –±–µ—Ä–µ—Ç index.html –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –≤–µ—Ç–∫—É gh-pages
    - name: üöÄ Deploy to GitHub Pages
      if: github.ref == 'refs/heads/main' # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        publish_branch: gh-pages
        keep_files: true
        include_files: index.html